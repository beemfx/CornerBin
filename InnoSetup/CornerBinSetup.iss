; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{7368B213-598B-4240-8C94-65420F2F9B3D}
AppName=CornerBin
AppVersion=1.0.0.2
;AppVerName=CornerBin 1.0.0
AppPublisher=Beem Media
AppPublisherURL=https://www.beemsoft.com/CornerBin
AppSupportURL=https://www.beemsoft.com/CornerBin
AppUpdatesURL=https://www.beemsoft.com/CornerBin
DefaultDirName={commonpf}\CornerBin
DefaultGroupName=CornerBin
AllowNoIcons=yes
OutputDir=../_DIST
OutputBaseFilename=cornerbin-installer
Compression=lzma
SolidCompression=yes

[Languages]
Name: "english"; MessagesFile: "compiler:Default.isl"

[Files]
Source: "..\_DIST\CornerBin.exe"; DestDir: "{app}"; Flags: ignoreversion
; TODO: Better reamde. Source: "..\README.md"; DestDir: "{app}";
Source: "..\LICENSE"; DestDir: "{app}";
; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
Name: "{group}\CornerBin"; Filename: "{app}\CornerBin.exe"
Name: "{group}\Settings"; Filename: "{app}\CornerBin.exe"; Parameters: "-settings"
;Name: "{group}\Help and Support"; Filename: "{app}\readme.html"
;Name: "{group}\{cm:ProgramOnTheWeb,CornerBin}"; Filename: "https://www.beemsoft.com/CornerBin"
;Name: "{group}\{cm:ProgramOnTheWeb,Beem Software}"; Filename: "http://www.beemsoft.com"
Name: "{group}\{cm:UninstallProgram,CornerBin}"; Filename: "{uninstallexe}"

[Run]
Filename: "{app}\CornerBin.exe"; Description: "{cm:LaunchProgram,CornerBin}"; Flags: nowait postinstall skipifsilent

[Registry]
Root: HKCU; Subkey: "Software\Beem Software\CornerBin"; Flags: uninsdeletekey
Root: HKLM; Subkey: "Software\Beem Software\CornerBin"; Flags: uninsdeletekey
Root: HKCU; Subkey: "Software\Microsoft\Windows\CurrentVersion\Run"; ValueName: "CornerBin"; Flags: uninsdeletevalue
Root: HKCU; Subkey: "Software\Beem Software\CornerBin"; ValueType: string; ValueData: "{app}"
Root: HKLM; Subkey: "Software\Beem Software\CornerBin"; ValueType: string; ValueData: "{app}"


[Code]
const
WM_CLOSE = 16;

Function InitializeSetup : Boolean;
begin
      Result := true;
end ;


function InitializeUninstall(): Boolean;
var winHwnd: longint;
    retVal : boolean;
begin
    Result := true;

    winHwnd := FindWindowByClassName('{7368B213-598B-4240-8C94-65420F2F9B3D}');
    Log('winHwnd: ' + inttostr(winHwnd));

    if winHwnd<> 0 then begin
      retVal := postmessage(winHwnd, WM_CLOSE, 0, 0);
    end

end;



